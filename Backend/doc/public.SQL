--   -------------------------------------------------- 
--   Generated by Enterprise Architect Version 8.0.856
--   Created On : martes, 24 diciembre, 2019 
--   DBMS       : PostgreSQL 
--   -------------------------------------------------- 

USE DATABASE postgres
;


--  Drop Tables, Stored Procedures and Views 

DROP TABLE IF EXISTS audit CASCADE
;
DROP TABLE IF EXISTS permission CASCADE
;
DROP TABLE IF EXISTS permission_role_permission CASCADE
;
DROP TABLE IF EXISTS person CASCADE
;
DROP TABLE IF EXISTS rol CASCADE
;
DROP TABLE IF EXISTS status CASCADE
;
DROP TABLE IF EXISTS user_db CASCADE
;

--  Create Tables 
CREATE TABLE audit ( 
	id bigint NOT NULL,
	table_name varchar(50) NOT NULL,
	table_column varchar(50) NOT NULL,
	new_value varchar(100) NOT NULL,
	old_value varchar(100) NOT NULL,
	type varchar(50) NOT NULL,
	date timestamp NOT NULL,
	username varchar(50) NOT NULL
)
;

CREATE TABLE permission ( 
	id integer NOT NULL,
	id_rol integer NOT NULL,
	description varchar(100)
)
;

CREATE TABLE permission_role_permission ( 
	permission integer NOT NULL,
	rol integer NOT NULL
)
;

CREATE TABLE person ( 
	id bigint NOT NULL,
	name varchar(50) NOT NULL,
	lastname varchar(50) NOT NULL,
	address varchar(50) NOT NULL,
	phone varchar(50) NOT NULL
)
;

CREATE TABLE rol ( 
	id integer NOT NULL,
	name varchar(50) NOT NULL,
	description varchar(100)
)
;

CREATE TABLE status ( 
	id integer NOT NULL,
	name varchar(50) NOT NULL,
	description varchar(100)
)
;

CREATE TABLE user_db ( 
	id bigint NOT NULL,
	id_person bigint NOT NULL,
	id_rol integer NOT NULL,
	status integer NOT NULL,
	username varchar(50) NOT NULL,
	email varchar(50) NOT NULL,
	password varchar(50) NOT NULL
)
;


--  Create Primary Key Constraints 
ALTER TABLE audit ADD CONSTRAINT PK_audit 
	PRIMARY KEY (id)
;


ALTER TABLE permission ADD CONSTRAINT PK_permission 
	PRIMARY KEY (id)
;


ALTER TABLE person ADD CONSTRAINT PK_person 
	PRIMARY KEY (id)
;


ALTER TABLE rol ADD CONSTRAINT PK_rol 
	PRIMARY KEY (id)
;


ALTER TABLE status ADD CONSTRAINT PK_status 
	PRIMARY KEY (id)
;


ALTER TABLE user_db ADD CONSTRAINT PK_user 
	PRIMARY KEY (id)
;




--  Create Foreign Key Constraints 
ALTER TABLE permission_role_permission ADD CONSTRAINT FK_permission_role_rol 
	FOREIGN KEY (rol) REFERENCES rol (id)
;

ALTER TABLE permission_role_permission ADD CONSTRAINT FK_permission_role_permission 
	FOREIGN KEY (permission) REFERENCES permission (id)
;

ALTER TABLE user_db ADD CONSTRAINT FK_status 
	FOREIGN KEY (status) REFERENCES status (id)
;

ALTER TABLE user_db ADD CONSTRAINT FK_user_db_rol 
	FOREIGN KEY (id_rol) REFERENCES rol (id)
;
