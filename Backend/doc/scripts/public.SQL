--   -------------------------------------------------- 
--   Generated by Enterprise Architect Version 8.0.856
--   Created On : jueves, 26 diciembre, 2019 
--   DBMS       : PostgreSQL 
--   -------------------------------------------------- 

USE DATABASE postgres
;


--  Drop Tables, Stored Procedures and Views 

DROP TABLE IF EXISTS audit CASCADE
;
DROP TABLE IF EXISTS permission CASCADE
;
DROP TABLE IF EXISTS permission_role_permission CASCADE
;
DROP TABLE IF EXISTS person CASCADE
;
DROP TABLE IF EXISTS rol CASCADE
;
DROP TABLE IF EXISTS status CASCADE
;
DROP TABLE IF EXISTS user CASCADE
;

--  Create Tables 
CREATE TABLE audit ( 
	id_audit bigint NOT NULL,
	table_name varchar(50) NOT NULL,
	table_column varchar(50) NOT NULL,
	new_value varchar(100) NOT NULL,
	old_value varchar(100) NOT NULL,
	type varchar(50) NOT NULL,
	date timestamp NOT NULL,
	username varchar(50) NOT NULL
)
;

CREATE TABLE permission ( 
	id_permission integer NOT NULL,
	description varchar(100)
)
;

CREATE TABLE permission_role_permission ( 
	permission integer,
	rol integer
)
;

CREATE TABLE person ( 
	id_person bigint NOT NULL,
	name varchar(50) NOT NULL,
	lastname varchar(50) NOT NULL,
	date_birth timestamp NOT NULL,
	address varchar(50) NOT NULL,
	phone varchar(50) NOT NULL
)
;

CREATE TABLE rol ( 
	id_rol integer NOT NULL,
	name varchar(50) NOT NULL,
	description varchar(100)
)
;

CREATE TABLE status ( 
	id_status integer NOT NULL,
	name varchar(50) NOT NULL,
	description varchar(100)
)
;

CREATE TABLE user ( 
	id_user bigint NOT NULL,
	person bigint NOT NULL,
	rol integer NOT NULL,
	status integer NOT NULL,
	username varchar(50) NOT NULL,
	email varchar(50) NOT NULL,
	password varchar(50) NOT NULL
)
;


--  Create Primary Key Constraints 
ALTER TABLE audit ADD CONSTRAINT PK_audit 
	PRIMARY KEY (id_audit)
;


ALTER TABLE permission ADD CONSTRAINT PK_permission 
	PRIMARY KEY (id_permission)
;


ALTER TABLE person ADD CONSTRAINT PK_person 
	PRIMARY KEY (id_person)
;


ALTER TABLE rol ADD CONSTRAINT PK_rol 
	PRIMARY KEY (id_rol)
;


ALTER TABLE status ADD CONSTRAINT PK_status 
	PRIMARY KEY (id_status)
;


ALTER TABLE user ADD CONSTRAINT PK_user 
	PRIMARY KEY (id_user)
;




--  Create Foreign Key Constraints 
ALTER TABLE permission_role_permission ADD CONSTRAINT FK_permission_role_rol 
	FOREIGN KEY (rol) REFERENCES rol (id_rol)
;

ALTER TABLE permission_role_permission ADD CONSTRAINT FK_permission_role_permission 
	FOREIGN KEY (permission) REFERENCES permission (id_permission)
;

ALTER TABLE user ADD CONSTRAINT FK_user_rol 
	FOREIGN KEY (rol) REFERENCES rol (id_rol)
;

ALTER TABLE user ADD CONSTRAINT FK_user_status 
	FOREIGN KEY (status) REFERENCES status (id_status)
;

ALTER TABLE user ADD CONSTRAINT FK_user_person 
	FOREIGN KEY (person) REFERENCES person (id_person)
;
